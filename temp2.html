<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WMS GetFeatureInfo</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->

    <script src="js/leaflet.js"></script>
    <style type="text/css">
      html, body, #map {
        margin: 0px;
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="js/jquery-1.12.0.min.js"></script>
    <script>
      var map = L.map('map', {center: [53.03, 52.16], zoom: 10});

      L.tileLayer("https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}", {
            maxZoom: 20,
            attribution: ''
        }).addTo(map);

//        map.on('click', function(e) {
//            alert("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng)
//        });

        var condition = '';
        var owsrootUrl = 'http://192.168.0.117:8080/geoserver/Geoportal/ows';
        var WFSLayer = null;
        map.on('click', function addWV2015(e) {
            if (map.hasLayer(WFSLayer)) {
                WFSLayer.clearLayers();
            }
            var defaultParameters = {
                service: 'WFS',
                version: '2.0',
                request: 'GetFeature',
                typeName: 'Geoportal:species',
                outputFormat: 'text/javascript',
                cql_filter: 'CONTAINS(the_geom, POINT('+ e.latlng.lat + ' ' + e.latlng.lng +'))',
                format_options: 'callback:getJson',
                maxFeatures : '25',

                SrsName: 'EPSG:4326'
            };
            var parameters = L.Util.extend(defaultParameters);
            var URL = owsrootUrl + L.Util.getParamString(parameters);

            //var WFSLayer = null; изначально объявление стоит тут, но изза необходимости очищать слой временно вынесено за функцию
            var ajax = $.ajax({
                url: URL,
                dataType: 'jsonp',
                jsonpCallback: 'getJson',
                success: function (response) {
                    WFSLayer = L.geoJson(response, {
                        style: function () {
                            return {
                                stroke: true,
                                weight: 3,
                                //color: '#FF0000',
                                //opacity: 1,
                                fillColor: 'FFFFFF',
                                fillOpacity: 0
                            };
                        },
                        onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 250};
                            layer.bindPopup((feature.properties.PR_PORODA)
                                    , popupOptions);
                        }
                    }).addTo(map);
                }
            });
        })

    </script>
  </body>
</html>